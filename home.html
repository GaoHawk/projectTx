
<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--标准mui.css-->
		<link rel="stylesheet" href="css/MUI.min.css">

		<script src="js/browser.js"></script>
		<script src="js/jQuery-2.2.1.min.js"></script>
		<script src="firstPage.es5.js"></script>
		<script src="secondPage.es5.js"></script>
		<script type="text/babel">

		</script>
		<style>
			.mui-plus.mui-android header.mui-bar{
			  display: none;
			}
			.mui-plus.mui-android .mui-bar-nav~.mui-content{
			  padding: 0;
			}
			.title{
				margin: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
			}

			.oa-contact-cell.mui-table .mui-table-cell {
				padding: 11px 0;
				vertical-align: middle;
			}

			.oa-contact-cell {
				position: relative;
				margin: -11px 0;
			}

			.oa-contact-avatar {
				width: 75px;
			}
			.oa-contact-avatar img {
				border-radius: 50%;
			}
			.oa-contact-content {
				width: 100%;
			}
			.oa-contact-name {
				margin-right: 20px;
			}
			.oa-contact-name, oa-contact-position {
				float: left;
			}
			.custom-nav-shadow{
				box-shadow: 0 0 0px rgba(0,0,0,0);
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">底部选项卡-div模式</h1>
			<a class="mui-icon mui-icon-bars mui-pull-right mui-tab-item" href="#tabbar-with-contact"></a>
		</header>
		<nav class="mui-bar mui-bar-tab custom-nav-shadow" >
			<a class="mui-tab-item mui-active" href="#tabbar">
				<span class="mui-icon mui-icon-home"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a class="mui-tab-item" href="#tabbar-with-chat">
				<span class="mui-icon mui-icon-upload"></span>
				<span class="mui-tab-label">礼包</span>
			</a>
			<a class="mui-tab-item" href="#tabbar-with-contact">
				<span class="mui-icon mui-icon-pengyouquan"></span>
				<span class="mui-tab-label">游戏</span>
			</a>
			<a class="mui-tab-item" href="#tabbar-with-map">
				<span class="mui-icon mui-icon-chatbubble"></span>
				<span class="mui-tab-label">咨询</span>
			</a>
			<a class="mui-tab-item" href="#">
				<span class="mui-icon mui-icon-star"></span>
				<span class="mui-tab-label">推荐</span>
			</a>
		</nav>
		<div class="mui-content">
			<div id="tabbar" class="mui-control-content mui-active">
			<script>
				$("#tabbar").append(html);
			</script>

			</div>
			<div id="tabbar-with-chat" class="mui-control-content">
				<script>
					$("#tabbar-with-chat").append(html2);
				</script>

			</div>
			<div id="tabbar-with-contact" class="mui-control-content">
				<div class="title">这是div模式选项卡中的第3个子页面，该页面展示一个通讯录示例.</div>
				<ul class="mui-table-view mui-table-view-striped mui-table-view-condensed">
				<li class="mui-table-view-cell">
					<div class="mui-slider-cell">
						<div class="oa-contact-cell mui-table">
							<div class="oa-contact-avatar mui-table-cell">
								<img src="images/60x60.gif" />
							</div>
							<div class="oa-contact-content mui-table-cell">
								<div class="mui-clearfix">
									<h4 class="oa-contact-name">叶文洁</h4>
									<span class="oa-contact-position mui-h6">董事长</span>
								</div>
								<p class="oa-contact-email mui-h6">
									yewenjie@sina.com
								</p>
							</div>
						</div>
					</div>
				</li>
				<li class="mui-table-view-cell">
					<div class="mui-slider-cell">
						<div class="oa-contact-cell mui-table">
							<div class="oa-contact-avatar mui-table-cell">
								<img src="images/60x60.gif" />
							</div>
							<div class="oa-contact-content mui-table-cell">
								<div class="mui-clearfix">
									<h4 class="oa-contact-name">艾AA</h4>
									<span class="oa-contact-position mui-h6">总经理</span>
								</div>
								<p class="oa-contact-email mui-h6">
									aaa@163.com
								</p>
							</div>
						</div>
					</div>
				</li>
				<li class="mui-table-view-cell">
					<div class="mui-slider-cell">
						<div class="oa-contact-cell mui-table">
							<div class="oa-contact-avatar mui-table-cell">
								<img src="images/60x60.gif" />
							</div>
							<div class="oa-contact-content mui-table-cell">
								<div class="mui-clearfix">
									<h4 class="oa-contact-name">罗辑</h4>
									<span class="oa-contact-position mui-h6">员工</span>
								</div>
								<p class="oa-contact-email mui-h6">
									luoji@126.com
								</p>
							</div>
						</div>
					</div>
				</li>
				<li class="mui-table-view-cell">
					<div class="mui-slider-cell">
						<div class="oa-contact-cell mui-table">
							<div class="oa-contact-avatar mui-table-cell">
								<img src="images/60x60.gif" />
							</div>
							<div class="oa-contact-content mui-table-cell">
								<div class="mui-clearfix">
									<h4 class="oa-contact-name">云天明</h4>
									<span class="oa-contact-position mui-h6">员工</span>
								</div>
								<p class="oa-contact-email mui-h6">
									ytm@163.com
								</p>
							</div>
						</div>
					</div>
				</li>
				<li class="mui-table-view-cell">
					<div class="mui-slider-cell">
						<div class="oa-contact-cell mui-table">
							<div class="oa-contact-avatar mui-table-cell">
								<img src="images/60x60.gif" />
							</div>
							<div class="oa-contact-content mui-table-cell">
								<div class="mui-clearfix">
									<h4 class="oa-contact-name">史强</h4>
									<span class="oa-contact-position mui-h6">员工</span>
								</div>
								<p class="oa-contact-email mui-h6">
									shiqiang@gmail.com
								</p>
							</div>
						</div>
					</div>
				</li>
			</ul>
			</div>
			<div id="tabbar-with-map" class="mui-control-content">
				<div class="title">这是div模式选项卡中的第4个子页面，该页面展示一个常见的设置示例.</div>
				<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right">
						新消息通知
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right">
						隐私
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right">
						通用
					</a>
				</li>
			</ul>
			<ul class="mui-table-view" style="margin-top: 25px;">
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right">
						关于mui
					</a>
				</li>
			</ul>
			<ul class="mui-table-view" style="margin-top: 25px;">
				<li class="mui-table-view-cell">
					<a style="text-align: center;color: #FF3B30;">
						退出登录
					</a>
				</li>
			</ul>
			</div>
		</div>
	</body>
	<script src="js/MUI.min.js"></script>
	<script>
		mui.init({
			swipeBack:true //启用右滑关闭功能
		});
		// 内容
		var eleContents = $("div.mui-control-content");
		//选项卡 标签
		var abtns = $("a.mui-tab-item");
		var eleMenus = abtns.bind("tap", function(event){
			console.log($(this)[0].hash);
			var query = $(this)[0].hash.slice(1);
			var title = "pjax跳转" + query;
			document.title = title;


			for (var i = 0; i < abtns.length; i++) {
				if($(abtns[i]).hasClass('mui-active')){
					$(abtns[i]).removeClass('mui-active');
				}
			}
			$(this).addClass('mui-active');
			if (event) {
			for (var i = 0; i < eleContents.length; i++) {
				if(eleContents[i].id == query){
					$(eleContents[i]).show();

				}else{

					$(eleContents[i]).hide();
				}
			}
			  history.pushState({ title: title }, title, location.href.split("?")[0] + "?" + query);
			}
			return false;
		});

		var fnHashTrigger = function(target){
			var query = location.href.split("?")[1], eleTarget = target || null;
			console.log(query);
			console.log(eleTarget);
			if (typeof query == "undefined") {
			  // if (eleTarget = eleMenus.get(0)) {
			  //   history.replaceState(null, document.title, location.href.split("#")[0] + "?" + eleTarget.href.split("?")[1]) + location.hash;
			  //   fnHashTrigger(eleTarget);
			  // }
			  eleTarget = abtns[0];
			  history.replaceState(null,document.title,location.href.split("#")[0] + "?" + eleTarget.hash.slice(1));
			  fnHashTrigger(eleTarget);
			} else {

				for (var i = 0; i < eleContents.length; i++) {
					if(eleContents[i].id == query){
						console.log(eleContents[i]);
						$(eleContents[i]).show();
					}else{
						$(eleContents[i]).hide();
					}
				}
				// if(eleTarget){
				// 	console.log(4);
				// 	$(eleTarget).click();
				// }
			  // eleMenus.each(function() {
			  //   if (eleTarget === null && this.href.split("?")[1] === query) {
			  //     eleTarget = this;
			  //   }
			  // });

			  // if (!eleTarget) {
			  //   history.replaceState(null, document.title, location.href.split("?")[0]);
			  //   fnHashTrigger();
			  // } else {
			  //   $(eleTarget).trigger("click");
			  // }
			}
		}

		if (history.pushState) {
		  window.addEventListener("popstate", function() {
		    fnHashTrigger();
		    console.log(1);
		  });
		  console.log(2);
		  // 默认载入
		  // fnHashTrigger();
		}
	</script>
</html>
